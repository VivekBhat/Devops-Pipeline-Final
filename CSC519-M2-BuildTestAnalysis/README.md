# CSC519-M-BuildTestAnalysis

Names:
	
  - Shaurya Garg (sgarg7)
  - Seyedsami Mirhosseini Ghamsari (smirhos)
  - Vivek Bhat (vbhat)
  - Nikhila Balaji (nbalaji)

## Link To Sceencasts
#### [Jenkins and build jobs setup](https://youtu.be/xJZqW3mR4yQ)
#### [Running Fuzzing on iTrust](https://youtu.be/y2lkHzjDEy8)  
#### [Running Checkbox.io build on Jenkins](https://youtu.be/bmOlREHurAg)


## Build Server

* Build jobs for itrust and checkbox.io

	* <b>itrust.xml</b> - mvn package command and other plugins added in publisher section for generating test coverage reports

	![alt text](https://github.ncsu.edu/smirhos/CSC519-M-BuildTestAnalysis/blob/master/Resources/itrust_xml.png "itrust.xml screenshot") 

   *  <b>Checkbox.xml </b>

	![alt text](https://github.ncsu.edu/smirhos/CSC519-M-BuildTestAnalysis/blob/master/Resources/checkboxio_xml.png "checkboxio.xml screenshot") 

* Jenkins Setup

	The main.yml ansible script located in jenkins/tasks has all the tasks that are required to set up jenkins - from setting the environment to install jenkins, jenkins plugins, setup git credentials, ssh keys, git webhooks, github-plugin configuration setup executors, copy build jobs for checkbox.io and itrust. In between these tasks jenkins server is often restarted to update the changes and the script makes 6 tries to wait for server to be back up before proceeding to the next task.

	<b>Jenkins Tasks List</b> can be found here [jenkins/tasks/main.yml]
![Image 1](https://github.ncsu.edu/smirhos/CSC519-M-BuildTestAnalysis/blob/master/Resources/flowchart1.PNG)
![Image 2](https://github.ncsu.edu/smirhos/CSC519-M-BuildTestAnalysis/blob/master/Resources/flowchart2.PNG)


### Testing Component [iTrust]

* Test suites, coverage and test results [20%]

	* Default test suite provided in itrust - run with Jenkins Junit, jaCoCo code coverage, and test-stability plugin

 	* The  post-commit hook script runs the fuzzer n times as defined in line 99 of `fuzzer.js`  as soon as a push is detected on the master.
	 	
	 *  Every time after the fuzzer commits a fuzzed version of the source code, it reverts back to original code before executing the fuzzer. The git segments are executed using execSynch operation and curl commands with variables values such as commit IDs passed on using `export` keyword.
	 
	 
 * Useless Test Detector - `UselessTestDetectorMain.java`
	 
 	* The useless Test Detector tool is implemented in java. The xml files generated by after every build from running the test-stability plugin is parsed using the java xml parser SAXParser. 

* Test case fuzzer [20%]

	* Fuzzer.js file and post-commit git hook

  		* [RegEx, execSync, walkSync, and writeFileSync,  appendFileSync are used to keep the operations in the fuzzer synchronous as it process the complete set of java files during one fuzzing operation]
		* Logic :
			* In fuzzer.js,  we use regular expressions to find and replace occurrences of < and > in instances where it is safe to do ( avoid replacing the lambda operator -> and the carats when defining arraylist such as <integer> )  
			* We also change occurrences of == to != and vice-versa 
			* A string is replaced with the text <i>“ThisIsANotSoRandomString”</i>. And we use a condition to avoid replacing java annotations in the source files.


## Analysis Component [checkbox.io]

**Max condition:** (greater than 8) 

**Long method:** (greater than 100 lines of code) 

**The Big O:**  (O greater than 3)

Fail the build if these occur - build job on checkbox.xml 

<hr>

## Extra credit [45%]
* Extend the test-stability-plugin to calculate and display "useless" tests in Jenkins. (20 points) - Attempted
	
	Generating a report using the results from test-stability plugin- not displaying currently in jenkins  
	
* If you can find 50 test that fail from fuzzing (5 points) - DONE
* If you can find 100 test that fail from fuzzing (10 points) - DONE
	
	That results are being stored in the `/var/lib/jenkins/jobs/iTrust-Fuzzer/builds/`
	- Also can be viewed [here](https://github.ncsu.edu/smirhos/CSC519-M-BuildTestAnalysis/blob/master/build_logs/builds/100/UselessTests.txt). The stats in this file are:
	  - Useless Tests : 492 
	  - Failed Tests : 673 
	- Proof for runing 100 build can be found [here](https://github.ncsu.edu/smirhos/CSC519-M-BuildTestAnalysis/tree/master/build_logs)
	
* If you can run 1000 builds and find at least 50 test failures (10 points) - not attempted

Contributions:	
  - Shaurya Garg (sgarg7) - build server setup and jenkins job, useless test detector
  - Seyedsami Mirhosseini Ghamsari (smirhos) - analysis for checkbox.io and build failure, current fuzzer
  - Vivek Bhat (vbhat) - earlier version of fuzzer and 100 commits, screencast merge, documentation
  - Nikhila Balaji (nbalaji) - earlier version of fuzzer and 100 commits, and documentation 
